FROM node:alpine AS build

ARG PGQL_HOST
ARG PGQL_PORT
ARG PGQL_USERNAME
ARG PGQL_PASSWORD
ARG PGQL_DATABASE
ARG MG_URL
ENV PGQL_HOST=$PGQL_HOST
ENV PGQL_PORT=$PGQL_PORT
ENV PGQL_USERNAME=$PGQL_USERNAME
ENV PGQL_PASSWORD=$PGQL_PASSWORD
ENV PGQL_DATABASE=$PGQL_DATABASE
ENV MG_URL=$MG_URL


WORKDIR /app
COPY ./ ./
RUN npm i --omit=dev
RUN npx tsc
FROM node:alpine
WORKDIR /app
COPY --from=build /app/build /app/build
CMD ["node","index.js"]
